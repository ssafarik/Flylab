###
# Installation Instructions for Flylab.
#
# The bulk of the software runs on Ubuntu, but if you want to run the galvodriver using 
# a National Instruments DAQ, then you'll also need a Windows machine with winros (so far 
# I've tested it w/ winros hydro) to run just the galvodriver node.  If you have a
# different DAQ, then you'll need to write a galvodriver for it.
#
###

# Install ROS Hydro on Ubuntu.
sudo apt-get install ros-hydro-desktop-full
sudo apt-get install ros-hydro-cmake-modules


# Add the following lines to your ~/.bashrc
source /opt/ros/hydro/setup.bash
export ROS_PACKAGE_PATH=~/src.git:~/src.hg:$ROS_PACKAGE_PATH    # (Assuming your ROS projects are in these two directories).
export ROS_IP=123.456.789.012                                   # (i.e. your ip)
export ROS_MASTER_URI=http://$ROS_IP:11311
export PYTHONPATH=~/src.git/Flylab/arena_tf/src:~/src.git/Flylab/flycore/src:$PYTHONPATH
export RIG=bigtop                                               # (change this to the name of your Flylab rig)


# Get the Flylab software.
cd ~/src.git
git clone https://github.com/ssafarik/Flylab.git


# Get simple_step.
cd ~/src.hg
hg clone https://bitbucket.org/willdickson/simple_step
python ~/src.hg/api/python/setup.py install
cd ~/src.git
git clone https://github.com/ssafarik/rosSimpleStep.git


# Get a few additional pieces.
easy_install munkres
sudo apt-get install python-numpy
sudo apt-get install python-scipy
sudo apt-get install libdc1394-22
sudo apt-get install libdc1394-22-dev
sudo apt-get install intltool
sudo apt-get install gobject-introspection


# Get Aravis camera library.
cd ~/src.git
git clone http://git.gnome.org/cgit/aravis
cd ~/src.git/aravis
./autogen.sh             # Might be necessary to comment out the line in configure.ac:  GTK_DOC_CHECK([1.14],[--flavour no-tmpl])
make
sudo make install


# Get camera_aravis ROS driver for aravis.
cd ~/src.git
git clone http://github.com/ssafarik/camera_aravis.git


# Make the Flylab software.
rosmake flylaball


# Verify that you have proper hardware:  i.e. a Flylab rig (the "RIG=___" line in your .bashrc) that consists 
# of, at minimum, a tracking camera (preferably ethernet) and an arena for flies to walk around.  It might also 
# have a robotic mechanism, a laser/galvo system, LED panels, lighting, etc. 
# 


# You're done!
# Assuming that flylaball finished without errors, and that you have functioning Flylab hardware, then you 
# should be able to run an experiment, for example:
roslaunch experiments testtracking.launch  





